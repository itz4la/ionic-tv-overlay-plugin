import{a as z}from"./chunk-CSOSYXAT.js";import{b as N}from"./chunk-2BJLPANP.js";import{a as D,c as R,e as j}from"./chunk-5GVKMHBT.js";import{a as q}from"./chunk-S2XR63X6.js";import{b as E,c as T,d as B}from"./chunk-36TWDYNZ.js";import{$ as a,Aa as v,Ba as b,Eb as S,Fb as I,G as C,Ga as y,Gb as w,Ja as O,L as r,N as p,P as f,Ta as k,U as u,X as d,aa as s,ba as c,ha as P,ra as m,sa as h,ta as x,ya as M,za as g}from"./chunk-4YXWHVVD.js";import"./chunk-PHJ65MTQ.js";import"./chunk-NGAVIYQ2.js";import"./chunk-DFS7RQGK.js";import"./chunk-IP3IRUG3.js";import"./chunk-YUJWRDDX.js";import"./chunk-HC6MZPB3.js";import"./chunk-QOCRLRQJ.js";import"./chunk-RMJ7PCZJ.js";import"./chunk-LSZSCLUI.js";import"./chunk-T6LT6B37.js";import"./chunk-QAYK5YJO.js";import"./chunk-EZ6AITSJ.js";import"./chunk-GNOVVPTF.js";import"./chunk-5OMUW5VI.js";import"./chunk-OBXDPQ3V.js";import"./chunk-HE67GXZG.js";import"./chunk-MCRJI3T3.js";import"./chunk-BAKMWPBW.js";import"./chunk-3VVAHO66.js";import"./chunk-6MXH2XA5.js";import"./chunk-7UI5LT65.js";import"./chunk-PDVW5TD3.js";import"./chunk-WR6SSK3X.js";import"./chunk-ILEDPWO7.js";import"./chunk-JWIEPCRG.js";import"./chunk-C5RQ2IC2.js";import"./chunk-SV7S5NYR.js";import{i as l}from"./chunk-OYAVQN5W.js";var F=(()=>{let n=class n{constructor(){}ngOnInit(){}};n.\u0275fac=function(e){return new(e||n)},n.\u0275cmp=f({type:n,selectors:[["app-spinner"]],decls:2,vars:0,consts:[[1,"backdrop"],[1,"loader"]],template:function(e,o){e&1&&(a(0,"div",0),c(1,"div",1),s())},styles:[".backdrop[_ngcontent-%COMP%]{position:fixed;top:0;left:0;width:100vw;height:100vh;background-color:#000000b3;display:flex;justify-content:center;align-items:center;z-index:9999}.loader[_ngcontent-%COMP%]{width:50px;padding:8px;aspect-ratio:1;border-radius:50%;background:#fff;--_m: conic-gradient(#0000 10%, #000), linear-gradient(#000 0 0) content-box;-webkit-mask:var(--_m);mask:var(--_m);-webkit-mask-composite:source-out;mask-composite:subtract;animation:_ngcontent-%COMP%_l3 1s infinite linear}@keyframes _ngcontent-%COMP%_l3{to{transform:rotate(1turn)}}"]});let t=n;return t})();var Q=t=>({BASEURI:t});function L(t,n){t&1&&c(0,"app-spinner")}function V(t,n){t&1&&c(0,"div",11)}function W(t,n){if(t&1&&(a(0,"h2"),m(1),s()),t&2){let _=P();r(),h(_.formatedSlug(_.slug))}}var ce=(()=>{let n=class n{constructor(i,e,o,U,A,G){this.requestsService=i,this.router=e,this.authService=o,this.platform=U,this.zone=A,this.translateService=G,this.open=!1,this.openGenerateSlug=!1,this.userFound=!1,this.qrData="",this.uuid="",this.slug="",this.errorMsg="",this.BASEURI=q.FRONT_APP_URI}ionViewDidEnter(){return l(this,null,function*(){this.createDemandePayment(),this.backButtonSub=this.platform.backButton.subscribeWithPriority(10,()=>{this.onReturn()})})}ionViewDidLeave(){this.errorMsg="",this.uuid="",this.slug="",this.userFound=!1,this.intervalId&&(clearInterval(this.intervalId),this.intervalId=null),this.backButtonSub&&this.backButtonSub.unsubscribe()}createDemandePayment(){return l(this,null,function*(){this.openGenerateSlug=!0,this.requestsService.get("/demandes/create_payment_request").subscribe({next:i=>{let e=JSON.parse(this.requestsService.decrypt(i.data));this.uuid=e.demande.uuid,this.slug=e.demande.slug,this.qrData=this.BASEURI+"/payment/"+this.uuid,this.openGenerateSlug=!1,this.startCheckDemandeInterval()},error:i=>{let e=JSON.parse(this.requestsService.decrypt(i.error.data));this.errorMsg=e.message,setTimeout(()=>{this.errorMsg=""},5e3),this.openGenerateSlug=!1}})})}startCheckDemandeInterval(){this.intervalId&&(clearInterval(this.intervalId),this.intervalId=null),this.intervalId=setInterval(()=>l(this,null,function*(){this.checkDemandePayment({uuid:this.uuid})}),7e3)}checkDemandePayment(i){this.requestsService.post("/demandes/check_payment_request",i).subscribe({next:e=>l(this,null,function*(){let o=JSON.parse(this.requestsService.decrypt(e.data));o.demande.status===!0&&(this.authService.login(o.demande.token),this.router.navigate(["/home"]))}),error:e=>{let o=JSON.parse(this.requestsService.decrypt(e.error.data))}})}formatedSlug(i){var e;return(e=i.match(/.{1,4}/g))==null?void 0:e.join("-")}onReturn(){this.zone.run(()=>{this.router.navigateByUrl("/home")})}};n.\u0275fac=function(e){return new(e||n)(p(N),p(k),p(D),p(w),p(C),p(E))},n.\u0275cmp=f({type:n,selectors:[["app-payment"]],decls:21,vars:19,consts:[[3,"fullscreen"],[4,"ngIf"],[1,"page-body"],[1,"page-title"],[1,"phoneContainer"],[1,"content"],[2,"text-align","center"],[1,"ki-filled","ki-setting",2,"font-size","12px"],[3,"qrdata","width","errorCorrectionLevel"],[1,"fakeQrCode",2,"margin-top","14px"],["class","loader",4,"ngIf"],[1,"loader"]],template:function(e,o){e&1&&(a(0,"ion-content",0),u(1,L,1,0,"app-spinner",1),a(2,"div",2)(3,"p",3),m(4),g(5,"translate"),s(),a(6,"div",4)(7,"div",5)(8,"p",6),c(9,"i",7),m(10),g(11,"translate"),s(),c(12,"qrcode",8),s(),a(13,"div",5)(14,"p",6),c(15,"i",7),m(16),g(17,"translate"),s(),a(18,"div",9),u(19,V,1,0,"div",10)(20,W,2,1,"h2",1),s()()()()()),e&2&&(d("fullscreen",!0),r(),d("ngIf",o.open),r(3),h(v(5,10,"Choose how you want to make a payment")),r(6),x(" ",v(11,12,"Use the phone or tablet camera and point to this QR code")," "),r(2),d("qrdata",o.qrData)("width",150)("errorCorrectionLevel","M"),r(4),x(" ",b(17,14,"PAYMENT_INSTRUCTION",M(17,Q,o.BASEURI))," "),r(3),d("ngIf",o.openGenerateSlug),r(),d("ngIf",!o.openGenerateSlug))},dependencies:[j,R,O,y,S,I,z,F,B,T],styles:["p[_ngcontent-%COMP%]{margin:0}.page-body[_ngcontent-%COMP%]{padding:50px;display:flex;justify-content:center;align-items:center;flex-direction:column;background:radial-gradient(circle at top,#4a90e280,#4a90e24d 24%,#4a90e221 63%);height:100vh}.page-title[_ngcontent-%COMP%]{margin:0 0 50px;font-size:35px;color:#fff;font-weight:700;text-align:center}.nav[_ngcontent-%COMP%]{margin:0;padding:0}.navs[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;padding:0;gap:20px}.navs[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{border-radius:20px;border:1px solid #fff;list-style:none;padding:10px 20px;cursor:pointer;transition:background-color .3s,color .3s}.navs[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]:hover, .navs[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]:focus{background-color:#fff3}.phoneContainer[_ngcontent-%COMP%]{display:flex;gap:50px}.phoneContainer[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]{width:340px;display:flex;flex-direction:column;align-items:center;gap:20px}.phoneContainer[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .fakeQrCode[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;width:150px;height:150px;border:1px solid #fff;border-radius:10px}.remote-container[_ngcontent-%COMP%]{display:flex;justify-content:space-between;width:100%;min-width:300px;gap:50px}.remote-container[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:10px;border-radius:10px;width:100%;min-width:340px}.remote-container[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{color:#ffffffc7;font-size:14px}.remote-container[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   .form-title[_ngcontent-%COMP%]{text-align:center;color:#fff;margin-bottom:10px;font-size:20px;font-weight:600}.remote-container[_ngcontent-%COMP%]   .form-part[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:5px}.remote-container[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{border-radius:5px;background:transparent;border:1px solid #cacaca;padding:5px}.remote-container[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:focus{outline:none;border:1px solid #4a90e2;box-shadow:0 0 5px #4a90e299}.remote-container[_ngcontent-%COMP%]   .submit[_ngcontent-%COMP%]{background-color:#4a90e2;border:none;color:#fff;padding:5px 10px;border-radius:5px}.navs-button[_ngcontent-%COMP%]:focus{outline:3px solid #4a90e2;box-shadow:0 0 8px #4a90e299}.navs-button[aria-selected=true][_ngcontent-%COMP%]{font-weight:700;background-color:#4a90e233}@keyframes _ngcontent-%COMP%_ripple{0%{transform:scale(0);opacity:1}20%{transform:scale(25);opacity:1}to{opacity:0;transform:scale(40)}}.footer[_ngcontent-%COMP%]{position:fixed;bottom:30px;display:flex;gap:156px}.footer[_ngcontent-%COMP%]   .item[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;gap:10px}.footer[_ngcontent-%COMP%]   .item[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{border-radius:5px;padding:10px 20px;border:none;color:#fff}.alert[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:red;font-size:12px}.loader[_ngcontent-%COMP%]{width:50px;padding:8px;aspect-ratio:1;border-radius:50%;background:#fff;--_m: conic-gradient(#0000 10%, #000), linear-gradient(#000 0 0) content-box;-webkit-mask:var(--_m);mask:var(--_m);-webkit-mask-composite:source-out;mask-composite:subtract;animation:_ngcontent-%COMP%_l3 1s infinite linear}@keyframes _ngcontent-%COMP%_l3{to{transform:rotate(1turn)}}"]});let t=n;return t})();export{ce as PaymentPage};
